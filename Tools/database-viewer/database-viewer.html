<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Premium Gift Box - Database Viewer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #2C5530 0%, #4A7C59 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .header {
            background: #2C5530;
            color: white;
            padding: 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .nav-tabs {
            background: #f8f9fa;
            padding: 0;
            border-bottom: 2px solid #e9ecef;
            display: flex;
        }

        .nav-tab {
            background: none;
            border: none;
            padding: 15px 25px;
            cursor: pointer;
            font-weight: 500;
            color: #6c757d;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .nav-tab:hover {
            background: #e9ecef;
            color: #2C5530;
        }

        .nav-tab.active {
            color: #2C5530;
            border-bottom-color: #2C5530;
            background: white;
        }

        .content {
            padding: 20px;
            min-height: 500px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .controls {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .controls input, .controls select, .controls button {
            padding: 8px 12px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 14px;
        }

        .controls button {
            background: #2C5530;
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.3s ease;
        }

        .controls button:hover {
            background: #1e3d21;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-radius: 8px;
            overflow: hidden;
        }

        .data-table th {
            background: #2C5530;
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 600;
        }

        .data-table td {
            padding: 12px;
            border-bottom: 1px solid #e9ecef;
            vertical-align: top;
        }

        .data-table tr:hover {
            background: #f8f9fa;
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
            text-transform: capitalize;
        }

        .status-pending { background: #fff3cd; color: #856404; }
        .status-designing { background: #cce5ff; color: #0066cc; }
        .status-production { background: #d4edda; color: #155724; }
        .status-completed { background: #d1ecf1; color: #0c5460; }
        .status-cancelled { background: #f8d7da; color: #721c24; }

        .loading {
            text-align: center;
            padding: 40px;
            color: #6c757d;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #2C5530 0%, #4A7C59 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .stat-label {
            font-size: 1.1em;
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üì¶ Premium Gift Box</h1>
            <p>Business Database Viewer & Management Tool</p>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('dashboard')">üìä Dashboard</button>
            <button class="nav-tab" onclick="showTab('orders')">üì¶ Orders</button>
            <button class="nav-tab" onclick="showTab('customers')">üë• Customers</button>
            <button class="nav-tab" onclick="showTab('inventory')">üìã Inventory</button>
            <button class="nav-tab" onclick="showTab('financial')">üí∞ Financial</button>
        </div>

        <div class="content">
            <!-- Dashboard Tab -->
            <div id="dashboard" class="tab-content active">
                <div class="stats-grid" id="statsGrid">
                    <!-- Stats will be loaded here -->
                </div>
                <div class="controls">
                    <button onclick="refreshDashboard()">üîÑ Refresh Data</button>
                    <button onclick="exportData()">üìä Export Report</button>
                </div>
            </div>

            <!-- Orders Tab -->
            <div id="orders" class="tab-content">
                <div class="controls">
                    <input type="text" id="orderSearch" placeholder="Search orders..." onkeyup="searchOrders()">
                    <select id="orderStatus" onchange="filterOrders()">
                        <option value="">All Statuses</option>
                        <option value="pending">Pending</option>
                        <option value="designing">Designing</option>
                        <option value="production">Production</option>
                        <option value="completed">Completed</option>
                        <option value="cancelled">Cancelled</option>
                    </select>
                    <button onclick="loadOrders()">üîÑ Refresh</button>
                    <button onclick="newOrder()">‚ûï New Order</button>
                </div>
                <div id="ordersTable">
                    <div class="loading">Loading orders...</div>
                </div>
            </div>

            <!-- Customers Tab -->
            <div id="customers" class="tab-content">
                <div class="controls">
                    <input type="text" id="customerSearch" placeholder="Search customers..." onkeyup="searchCustomers()">
                    <button onclick="loadCustomers()">üîÑ Refresh</button>
                    <button onclick="newCustomer()">‚ûï New Customer</button>
                </div>
                <div id="customersTable">
                    <div class="loading">Loading customers...</div>
                </div>
            </div>

            <!-- Inventory Tab -->
            <div id="inventory" class="tab-content">
                <div class="controls">
                    <button onclick="loadInventory()">üîÑ Refresh</button>
                    <button onclick="lowStockReport()">‚ö†Ô∏è Low Stock Alert</button>
                    <button onclick="addInventoryItem()">‚ûï Add Item</button>
                </div>
                <div id="inventoryTable">
                    <div class="loading">Loading inventory...</div>
                </div>
            </div>

            <!-- Financial Tab -->
            <div id="financial" class="tab-content">
                <div class="controls">
                    <input type="date" id="dateFrom" onchange="loadFinancial()">
                    <input type="date" id="dateTo" onchange="loadFinancial()">
                    <button onclick="loadFinancial()">üîÑ Refresh</button>
                    <button onclick="generateReport()">üìä Generate Report</button>
                </div>
                <div id="financialTable">
                    <div class="loading">Loading financial data...</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:3000/api';
        let currentData = {};

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadDashboard();
        });

        // Tab Management
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            // Load data for the tab
            switch(tabName) {
                case 'dashboard':
                    loadDashboard();
                    break;
                case 'orders':
                    loadOrders();
                    break;
                case 'customers':
                    loadCustomers();
                    break;
                case 'inventory':
                    loadInventory();
                    break;
                case 'financial':
                    loadFinancial();
                    break;
            }
        }

        // API Functions
        async function apiCall(endpoint, options = {}) {
            try {
                const response = await fetch(`${API_BASE}${endpoint}`, {
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers
                    },
                    ...options
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                return await response.json();
            } catch (error) {
                console.error('API Error:', error);
                showError(`Failed to load data: ${error.message}`);
                return null;
            }
        }

        // Dashboard Functions
        async function loadDashboard() {
            const stats = await apiCall('/analytics/dashboard');
            if (stats && stats.success) {
                displayDashboardStats(stats.data);
            }
        }

        function displayDashboardStats(data) {
            const statsGrid = document.getElementById('statsGrid');
            statsGrid.innerHTML = `
                <div class="stat-card">
                    <div class="stat-number">${data.total_orders || 0}</div>
                    <div class="stat-label">Total Orders</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${data.pending_orders || 0}</div>
                    <div class="stat-label">Pending Orders</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${data.completed_orders || 0}</div>
                    <div class="stat-label">Completed Orders</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${formatCurrency(data.total_revenue || 0)}</div>
                    <div class="stat-label">Total Revenue</div>
                </div>
            `;
        }

        // Orders Functions
        async function loadOrders() {
            const orders = await apiCall('/orders');
            if (orders && orders.success) {
                currentData.orders = orders.data;
                displayOrders(orders.data);
            }
        }

        function displayOrders(orders) {
            const container = document.getElementById('ordersTable');
            
            if (!orders || orders.length === 0) {
                container.innerHTML = '<div class="loading">No orders found</div>';
                return;
            }

            const tableHTML = `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Order #</th>
                            <th>Customer</th>
                            <th>Status</th>
                            <th>Total</th>
                            <th>Created</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${orders.map(order => `
                            <tr>
                                <td>${order.order_number}</td>
                                <td>${order.name || 'Unknown Customer'}</td>
                                <td><span class="status-badge status-${order.status}">${order.status}</span></td>
                                <td>${formatCurrency(order.total_price)}</td>
                                <td>${formatDate(order.created_at)}</td>
                                <td>
                                    <button onclick="viewOrder('${order.id}')">üëÅÔ∏è View</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;

            container.innerHTML = tableHTML;
        }

        // Customers Functions
        async function loadCustomers() {
            const customers = await apiCall('/customers');
            if (customers && customers.success) {
                currentData.customers = customers.data;
                displayCustomers(customers.data);
            }
        }

        function displayCustomers(customers) {
            const container = document.getElementById('customersTable');
            
            if (!customers || customers.length === 0) {
                container.innerHTML = '<div class="loading">No customers found</div>';
                return;
            }

            const tableHTML = `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Business Type</th>
                            <th>Contact</th>
                            <th>Orders</th>
                            <th>Created</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${customers.map(customer => `
                            <tr>
                                <td>${customer.name}</td>
                                <td>${customer.business_type || 'Individual'}</td>
                                <td>${customer.whatsapp || customer.email || customer.phone || 'No contact'}</td>
                                <td>${customer.total_orders || 0}</td>
                                <td>${formatDate(customer.created_at)}</td>
                                <td>
                                    <button onclick="viewCustomer('${customer.id}')">üëÅÔ∏è View</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;

            container.innerHTML = tableHTML;
        }

        // Utility Functions
        function formatCurrency(amount) {
            return new Intl.NumberFormat('id-ID', {
                style: 'currency',
                currency: 'IDR',
                minimumFractionDigits: 0,
            }).format(amount);
        }

        function formatDate(dateString) {
            if (!dateString) return 'N/A';
            return new Date(dateString).toLocaleDateString('id-ID');
        }

        function showError(message) {
            console.error(message);
            // Could show a toast notification here
        }

        // Placeholder functions (to be implemented)
        function refreshDashboard() { loadDashboard(); }
        function exportData() { alert('Export functionality coming soon!'); }
        function searchOrders() { /* Implement search */ }
        function filterOrders() { /* Implement filtering */ }
        function newOrder() { alert('New order form coming soon!'); }
        function viewOrder(id) { alert(`View order ${id}`); }
        function searchCustomers() { /* Implement search */ }
        function newCustomer() { alert('New customer form coming soon!'); }
        function viewCustomer(id) { alert(`View customer ${id}`); }
        function loadInventory() { alert('Inventory loading coming soon!'); }
        function lowStockReport() { alert('Low stock report coming soon!'); }
        function addInventoryItem() { alert('Add inventory item coming soon!'); }
        function loadFinancial() { alert('Financial data loading coming soon!'); }
        function generateReport() { alert('Report generation coming soon!'); }
    </script>
</body>
</html>